<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Process-Based Modeling - Probabilistic and Process Simulation | Quantitative Environmental Methods: LRES 546</title>
  <meta name="description" content="Chapter 3 Process-Based Modeling - Probabilistic and Process Simulation | Quantitative Environmental Methods: LRES 546" />
  <meta name="generator" content="bookdown 0.41 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Process-Based Modeling - Probabilistic and Process Simulation | Quantitative Environmental Methods: LRES 546" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Process-Based Modeling - Probabilistic and Process Simulation | Quantitative Environmental Methods: LRES 546" />
  
  
  

<meta name="author" content="Tim Covino &amp; Lauren Kremer" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="fundamentals-of-hydrological-analysis---physical-hydrology-and-empirical-methods.html"/>
<link rel="next" href="model-classification-and-application.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">lres_546</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Part 1: Foundations of Environmental Modeling</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#introduction"><i class="fa fa-check"></i><b>1.1</b> Introduction</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#course-overview-and-objectives"><i class="fa fa-check"></i><b>1.2</b> Course overview and objectives</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#course-description"><i class="fa fa-check"></i><b>1.3</b> Course Description</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#structure"><i class="fa fa-check"></i><b>1.4</b> Structure</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#philosophical-approach-and-resources"><i class="fa fa-check"></i><b>1.5</b> Philosophical approach and resources</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#tentative-schedule-subject-to-change"><i class="fa fa-check"></i><b>1.6</b> Tentative schedule, subject to change</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="fundamentals-of-hydrological-analysis---physical-hydrology-and-empirical-methods.html"><a href="fundamentals-of-hydrological-analysis---physical-hydrology-and-empirical-methods.html"><i class="fa fa-check"></i><b>2</b> Fundamentals of Hydrological Analysis - Physical Hydrology and Empirical Methods</a>
<ul>
<li class="chapter" data-level="2.1" data-path="fundamentals-of-hydrological-analysis---physical-hydrology-and-empirical-methods.html"><a href="fundamentals-of-hydrological-analysis---physical-hydrology-and-empirical-methods.html#hydrograph-separation"><i class="fa fa-check"></i><b>2.1</b> Hydrograph separation</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="fundamentals-of-hydrological-analysis---physical-hydrology-and-empirical-methods.html"><a href="fundamentals-of-hydrological-analysis---physical-hydrology-and-empirical-methods.html#learning-module-1"><i class="fa fa-check"></i><b>2.1.1</b> Learning Module 1</a></li>
<li class="chapter" data-level="2.1.2" data-path="fundamentals-of-hydrological-analysis---physical-hydrology-and-empirical-methods.html"><a href="fundamentals-of-hydrological-analysis---physical-hydrology-and-empirical-methods.html#labwork-20-pts"><i class="fa fa-check"></i><b>2.1.2</b> Labwork (20 pts)</a></li>
<li class="chapter" data-level="2.1.3" data-path="fundamentals-of-hydrological-analysis---physical-hydrology-and-empirical-methods.html"><a href="fundamentals-of-hydrological-analysis---physical-hydrology-and-empirical-methods.html#repo-link"><i class="fa fa-check"></i><b>2.1.3</b> Repo link</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="fundamentals-of-hydrological-analysis---physical-hydrology-and-empirical-methods.html"><a href="fundamentals-of-hydrological-analysis---physical-hydrology-and-empirical-methods.html#return-intervals"><i class="fa fa-check"></i><b>2.2</b> Return Intervals</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="fundamentals-of-hydrological-analysis---physical-hydrology-and-empirical-methods.html"><a href="fundamentals-of-hydrological-analysis---physical-hydrology-and-empirical-methods.html#learning-module-2"><i class="fa fa-check"></i><b>2.2.1</b> Learning Module 2</a></li>
<li class="chapter" data-level="2.2.2" data-path="fundamentals-of-hydrological-analysis---physical-hydrology-and-empirical-methods.html"><a href="fundamentals-of-hydrological-analysis---physical-hydrology-and-empirical-methods.html#labwork-20-pts-1"><i class="fa fa-check"></i><b>2.2.2</b> Labwork (20 pts)</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="fundamentals-of-hydrological-analysis---physical-hydrology-and-empirical-methods.html"><a href="fundamentals-of-hydrological-analysis---physical-hydrology-and-empirical-methods.html#rational-method-and-nrcs-curve-number-20-pts"><i class="fa fa-check"></i><b>2.3</b> Rational method and NRCS curve number (20 pts)</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="fundamentals-of-hydrological-analysis---physical-hydrology-and-empirical-methods.html"><a href="fundamentals-of-hydrological-analysis---physical-hydrology-and-empirical-methods.html#learning-module-3"><i class="fa fa-check"></i><b>2.3.1</b> Learning Module 3</a></li>
<li class="chapter" data-level="2.3.2" data-path="fundamentals-of-hydrological-analysis---physical-hydrology-and-empirical-methods.html"><a href="fundamentals-of-hydrological-analysis---physical-hydrology-and-empirical-methods.html#labwork-20-pts-2"><i class="fa fa-check"></i><b>2.3.2</b> Labwork (20 pts)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="process-based-modeling---probabilistic-and-process-simulation.html"><a href="process-based-modeling---probabilistic-and-process-simulation.html"><i class="fa fa-check"></i><b>3</b> Process-Based Modeling - Probabilistic and Process Simulation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="process-based-modeling---probabilistic-and-process-simulation.html"><a href="process-based-modeling---probabilistic-and-process-simulation.html#transfer-function-rainfall-runoff-models"><i class="fa fa-check"></i><b>3.1</b> Transfer function rainfall-runoff models</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="process-based-modeling---probabilistic-and-process-simulation.html"><a href="process-based-modeling---probabilistic-and-process-simulation.html#learning-module-4"><i class="fa fa-check"></i><b>3.1.1</b> Learning Module 4</a></li>
<li class="chapter" data-level="3.1.2" data-path="process-based-modeling---probabilistic-and-process-simulation.html"><a href="process-based-modeling---probabilistic-and-process-simulation.html#repo-link-1"><i class="fa fa-check"></i><b>3.1.2</b> Repo link</a></li>
<li class="chapter" data-level="3.1.3" data-path="process-based-modeling---probabilistic-and-process-simulation.html"><a href="process-based-modeling---probabilistic-and-process-simulation.html#labwork-20-pts-3"><i class="fa fa-check"></i><b>3.1.3</b> Labwork (20 pts)</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="process-based-modeling---probabilistic-and-process-simulation.html"><a href="process-based-modeling---probabilistic-and-process-simulation.html#monte-carlo-simulation"><i class="fa fa-check"></i><b>3.2</b> Monte Carlo Simulation</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="process-based-modeling---probabilistic-and-process-simulation.html"><a href="process-based-modeling---probabilistic-and-process-simulation.html#learning-module-5"><i class="fa fa-check"></i><b>3.2.1</b> Learning Module 5</a></li>
<li class="chapter" data-level="3.2.2" data-path="process-based-modeling---probabilistic-and-process-simulation.html"><a href="process-based-modeling---probabilistic-and-process-simulation.html#repo-link-2"><i class="fa fa-check"></i><b>3.2.2</b> Repo link</a></li>
<li class="chapter" data-level="3.2.3" data-path="process-based-modeling---probabilistic-and-process-simulation.html"><a href="process-based-modeling---probabilistic-and-process-simulation.html#labwork-20-pnts"><i class="fa fa-check"></i><b>3.2.3</b> Labwork (20 pnts)</a></li>
<li class="chapter" data-level="3.2.4" data-path="process-based-modeling---probabilistic-and-process-simulation.html"><a href="process-based-modeling---probabilistic-and-process-simulation.html#sensitivity-analysis"><i class="fa fa-check"></i><b>3.2.4</b> Sensitivity analysis</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="model-classification-and-application.html"><a href="model-classification-and-application.html"><i class="fa fa-check"></i><b>4</b> Model Classification and Application</a>
<ul>
<li class="chapter" data-level="4.1" data-path="model-classification-and-application.html"><a href="model-classification-and-application.html#classifying-model-structure"><i class="fa fa-check"></i><b>4.1</b> Classifying model structure</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="model-classification-and-application.html"><a href="model-classification-and-application.html#learning-module-6"><i class="fa fa-check"></i><b>4.1.1</b> Learning Module 6</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="model-classification-and-application.html"><a href="model-classification-and-application.html#term-project-assignment-1---10-pnts"><i class="fa fa-check"></i><b>4.2</b> Term Project Assignment 1 - 10 pnts</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="model-classification-and-application.html"><a href="model-classification-and-application.html#brainstorming"><i class="fa fa-check"></i><b>4.2.1</b> Brainstorming</a></li>
<li class="chapter" data-level="4.2.2" data-path="model-classification-and-application.html"><a href="model-classification-and-application.html#data-exploration-and-selection"><i class="fa fa-check"></i><b>4.2.2</b> Data exploration and selection</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="model-classification-and-application.html"><a href="model-classification-and-application.html#snowmelt-models"><i class="fa fa-check"></i><b>4.3</b> Snowmelt Models</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="model-classification-and-application.html"><a href="model-classification-and-application.html#learning-module-7"><i class="fa fa-check"></i><b>4.3.1</b> Learning Module 7</a></li>
<li class="chapter" data-level="4.3.2" data-path="model-classification-and-application.html"><a href="model-classification-and-application.html#labwork-20-pnts-1"><i class="fa fa-check"></i><b>4.3.2</b> Labwork (20 pnts)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="physical-process-models.html"><a href="physical-process-models.html"><i class="fa fa-check"></i><b>5</b> Physical Process Models</a>
<ul>
<li class="chapter" data-level="5.1" data-path="physical-process-models.html"><a href="physical-process-models.html#evapotranspiration"><i class="fa fa-check"></i><b>5.1</b> Evapotranspiration</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="physical-process-models.html"><a href="physical-process-models.html#repo-here"><i class="fa fa-check"></i><b>5.1.1</b> Repo here</a></li>
<li class="chapter" data-level="5.1.2" data-path="physical-process-models.html"><a href="physical-process-models.html#learning-module-8"><i class="fa fa-check"></i><b>5.1.2</b> Learning Module 8</a></li>
<li class="chapter" data-level="5.1.3" data-path="physical-process-models.html"><a href="physical-process-models.html#labwork-20-pts-4"><i class="fa fa-check"></i><b>5.1.3</b> Labwork (20 pts):</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="spatial-models-and-gis-integration.html"><a href="spatial-models-and-gis-integration.html"><i class="fa fa-check"></i><b>6</b> Spatial Models and GIS Integration</a>
<ul>
<li class="chapter" data-level="6.1" data-path="spatial-models-and-gis-integration.html"><a href="spatial-models-and-gis-integration.html#gridded-and-tabular-data-retrieval"><i class="fa fa-check"></i><b>6.1</b> Gridded and tabular data retrieval</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="spatial-models-and-gis-integration.html"><a href="spatial-models-and-gis-integration.html#learning-module-9"><i class="fa fa-check"></i><b>6.1.1</b> Learning Module 9</a></li>
<li class="chapter" data-level="6.1.2" data-path="spatial-models-and-gis-integration.html"><a href="spatial-models-and-gis-integration.html#repo-link-3"><i class="fa fa-check"></i><b>6.1.2</b> Repo link</a></li>
<li class="chapter" data-level="6.1.3" data-path="spatial-models-and-gis-integration.html"><a href="spatial-models-and-gis-integration.html#labwork-20-pnts-2"><i class="fa fa-check"></i><b>6.1.3</b> Labwork (20 pnts)</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="spatial-models-and-gis-integration.html"><a href="spatial-models-and-gis-integration.html#dem-processing"><i class="fa fa-check"></i><b>6.2</b> DEM processing</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="spatial-models-and-gis-integration.html"><a href="spatial-models-and-gis-integration.html#learning-module-10"><i class="fa fa-check"></i><b>6.2.1</b> Learning Module 10</a></li>
<li class="chapter" data-level="6.2.2" data-path="spatial-models-and-gis-integration.html"><a href="spatial-models-and-gis-integration.html#the-link-to-the-repo-is-here"><i class="fa fa-check"></i><b>6.2.2</b> THE LINK TO THE REPO IS HERE</a></li>
<li class="chapter" data-level="6.2.3" data-path="spatial-models-and-gis-integration.html"><a href="spatial-models-and-gis-integration.html#labwork-20-pts-5"><i class="fa fa-check"></i><b>6.2.3</b> Labwork (20 pts)</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Quantitative Environmental Methods: LRES 546</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="process-based-modeling---probabilistic-and-process-simulation" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">Chapter 3</span> Process-Based Modeling - Probabilistic and Process Simulation<a href="process-based-modeling---probabilistic-and-process-simulation.html#process-based-modeling---probabilistic-and-process-simulation" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>* Modules 3.1 and 3.2 are adapted from Fabian Nipggen (REWM.4500.500)<br />
</p>
<div id="transfer-function-rainfall-runoff-models" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Transfer function rainfall-runoff models<a href="process-based-modeling---probabilistic-and-process-simulation.html#transfer-function-rainfall-runoff-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="learning-module-4" class="section level3 hasAnchor" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> Learning Module 4<a href="process-based-modeling---probabilistic-and-process-simulation.html#learning-module-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="summary-1" class="section level4 hasAnchor" number="3.1.1.1">
<h4><span class="header-section-number">3.1.1.1</span> Summary<a href="process-based-modeling---probabilistic-and-process-simulation.html#summary-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>In previous modules, we explored how watershed characteristics influence the flow of input water through or over hillslopes to quickly contribute to stormflow or to be stored for later contribution to baseflow. Therefore, the partitioning of flow into baseflow or stormflow can be determined by the time it spends in the watershed. Furthermore, the residence time of water in various pathways may affect weathering and solute transport within watersheds. To improve our understanding of water movement within a watershed, it can be crucial to incorporate water transit time into hydrological models. This consideration allows for a more realistic representation of how water moves through various storage compartments, such as soil, groundwater, and surface water, accounting for the time it takes for water to traverse these pathways.</p>
<p>In this module, we will model the temporal aspects of runoff response to input using a transfer function. First, please read: <br/></p>
<p><a href="docs/Weiler_etal_WRR2003.pdf">TRANSEP - a combined tracer and runoff transfer function hydrograph separation model</a>
<br/></p>
<p>Then this chapter will step through key concepts in the paper to facilitate hands-on exploration of the rainfall-runoff portion of the TRANSEP model in the assessment. Then, we will introduce examples of other transfer functions to demonstrate alternative ways of representing time-induced patterns in hydrological modeling, prompting you to consider response patterns in your study systems.</p>
</div>
<div id="overall-learning-objectives-1" class="section level4 hasAnchor" number="3.1.1.2">
<h4><span class="header-section-number">3.1.1.2</span> Overall Learning Objectives<a href="process-based-modeling---probabilistic-and-process-simulation.html#overall-learning-objectives-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>At the end of this module, students should be able to describe several ways to model and identify transit time within hydrological models. They should have a general understanding of how water transit time may influence the timing and composition of runoff.</p>
</div>
<div id="terminology" class="section level4 hasAnchor" number="3.1.1.3">
<h4><span class="header-section-number">3.1.1.3</span> Terminology<a href="process-based-modeling---probabilistic-and-process-simulation.html#terminology" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>In modeling a flow system, note that consideration of time may vary depending on the questions being asked. <strong>Transit time</strong> is the average time required for water to travel through the entire flow system, from input (e.g., rainfall on soil surface) to output (e.g., discharge). <strong>Residence time</strong> is a portion of transit time, describing the amount of time water spends within a specific component of the flow system, like storage (e.g., in soil, groundwater, or a lake).</p>
<div class="float">
<img src="https://ars.els-cdn.com/content/image/1-s2.0-S0022169406002150-gr1.jpg" alt="Figure 6.3. Conceptual diagram of the lumped parameter transit time modeling approach (McGuire &amp; McDonnell, 2006)" />
<div class="figcaption">Figure 6.3. Conceptual diagram of the lumped parameter transit time modeling approach (McGuire &amp; McDonnell, 2006)</div>
</div>
<p><br/><br/></p>
<p>A <strong>transfer function</strong> (TF) is a mathematical representation of how a system responds to input signals. In a hydrological context, it describes the transformation of inputs (e.g. precipitation) to outputs (e.g. runoff). These models can be valuable tools for understanding the time-varying dynamics of a hydrological system.</p>
</div>
<div id="the-linear-time-invariant-tf" class="section level4 hasAnchor" number="3.1.1.4">
<h4><span class="header-section-number">3.1.1.4</span> The Linear Time-Invariant TF<a href="process-based-modeling---probabilistic-and-process-simulation.html#the-linear-time-invariant-tf" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We’ll begin the discussion in the context of a <strong>linear reservoir</strong>. Linear reservoirs are simple models designed to simulate the storage and discharge of water in a catchment. These models assume that the catchment can be represented as single storage compartments or as a series of interconnected storage compartments and that the change the amount of water stored in the reservoir (or reservoirs) is directly proportional to the inflows and outflows. In other words, the linear relationship between inflows and outflows means that the rate of water release is proportional to the amount of water stored in the reservoir.</p>
<p><img src="images/linear_storage_04.png" /></p>
<p><br/><br/></p>
<div id="the-instantaneous-unit-hydrograph" class="section level5 hasAnchor" number="3.1.1.4.1">
<h5><span class="header-section-number">3.1.1.4.1</span> The Instantaneous Unit Hydrograph:<a href="process-based-modeling---probabilistic-and-process-simulation.html#the-instantaneous-unit-hydrograph" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>The Instantaneous Unit Hydrograph (IUH) represents the linear rainfall-runoff model used in the TRANSEP model. It is an approach to hydrograph separation that is useful for analyzing the temporal distribution of runoff in response to a ‘unit’ pulse of rainfall (e.g. uniform one-inch depth over a unit area represented by a unit hydrograph). In other words, it is a hydrograph that results from one unit (e.g. 1 mm) of effective rainfall uniformly distributed over the watershed and occurring in a short duration. Therefore, the following assumptions are made when the IUH is used as a transfer function: <br/>
1. the IUH reflects the ensemble of watershed characteristics <br/>
2. the shape characteristics of the unit hydrograph are independent of time <br/>
3. the output response is linearly proportional to the input</p>
<p><br/><br/></p>
<p><img src="images/linear_vs_IUH.png" alt="Chow, V.T., Maidment, D.R. and Mays, L.W. (1988) Applied Hydrology. International Edition, McGraw-Hill Book Company, New York." />
<br/><br/></p>
<p>By interpreting the IUH as a transfer function, we can model how the watershed translates rainfall into runoff. In the TRANSEP model, this transfer function is represented as <span class="math inline">\(g(\tau)\)</span> and thus the rainfall-induced response to runoff.</p>
<p><span class="math display">\[
g(\tau) = \frac{\tau^{\alpha-1}}{\mathrm{B}^{\alpha}\Gamma(\alpha)}exp(-\frac{\tau}{\alpha})
\]</span>
<br/><br/></p>
<p>The linear portion of the TRANSEP model describes a convolution of the effective precipitation and a runoff transfer function.</p>
<p><span class="math display">\[
Q(t)= \int_{0}^{t} g(\tau)p_{\text{eff}}(t-\tau)d\tau
\]</span>
<br/><br/>
Whoa, wait…what? Tau, integrals, and convolution? Don’t worry about the details of the equations. Check out this video to have convolution described using dollars and cookies, then imagine each dollar as a rainfall unit and each cookie as a runoff unit. Review the equations again after the video.</p>
<p><br/><br/></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="process-based-modeling---probabilistic-and-process-simulation.html#cb3-1" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_url</span>(<span class="st">&quot;https://www.youtube.com/embed/aEGboJxmq-w&quot;</span>)</span></code></pre></div>
<iframe src="https://www.youtube.com/embed/aEGboJxmq-w" width="672" height="400px" data-external="1">
</iframe>
</div>
<div id="the-loss-function" class="section level5 hasAnchor" number="3.1.1.4.2">
<h5><span class="header-section-number">3.1.1.4.2</span> The Loss Function:<a href="process-based-modeling---probabilistic-and-process-simulation.html#the-loss-function" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>The loss function represents the linear rainfall-runoff model used in the TRANSEP model.</p>
<p><span class="math display">\[
s(t) = b_{1} p(t + 1 - b_{2}^{-1}) s(t - \triangle t)
\]</span>
<span class="math display">\[
s(t = 0) = b_{3}
\]</span>
<span class="math display">\[
p_{\text{eff}}(t) = p(t) s(t)
\]</span>
where <span class="math inline">\(p_{\text{eff}}(t)\)</span> is the effective precipitation.<br/>
<span class="math inline">\(s(t)\)</span> is the antecedent precipitation index which is determined by giving more importance to recent precipitation and gradually reducing that importance as we go back in time. <br/>
The rate at which this importance decreases is controlled by the parameter <span class="math inline">\(b_{2}\)</span>. <br/>
The parameter <span class="math inline">\(b_{3}\)</span> sets the initial antecedent precipitation index at the beginning of the simulated time series.</p>
<p>In other words, these equations are used to simulate the flow of water in a hydrological system over time. The first equation represents the change in stored water at each time step, taking into account precipitation, loss to runoff, and the system’s past state. The second equation sets the initial condition for the storage at the beginning of the simulation. The third equation calculates the effective precipitation, considering both precipitation and the current storage state.</p>
</div>
<div id="how-do-we-code-this" class="section level5 hasAnchor" number="3.1.1.4.3">
<h5><span class="header-section-number">3.1.1.4.3</span> How do we code this?<a href="process-based-modeling---probabilistic-and-process-simulation.html#how-do-we-code-this" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>We will use a skeletal version of TRANSEP, focusing only on the rainfall-runoff piece which includes the loss-function and the gamma transfer function.</p>
<p>We will use rainfall and runoff data from TCEF to model annual streamflow at a daily time step. Then we can use this model as a jump-off point to start talking about model calibration and validation in future modules.</p>
</div>
<div id="final-thoughts" class="section level5 hasAnchor" number="3.1.1.4.4">
<h5><span class="header-section-number">3.1.1.4.4</span> Final thoughts:<a href="process-based-modeling---probabilistic-and-process-simulation.html#final-thoughts" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>If during your modeling experience, you find yourself wading through a bog of complex physics and multiple layers of transfer functions to account for every drop of input into a system, it is time to revisit your objectives. Remember that a model is always ‘wrong’. Like a map, it provides a simplified representation of reality. It may not be entirely accurate, but it serves a valuable purpose. Models help us understand complex systems, make predictions, and gain insights even if they are not an exact replica of the real world. Check out this paper for more:</p>
<p><a href="https://agupubs.onlinelibrary.wiley.com/doi/10.1029/93WR00877" class="uri">https://agupubs.onlinelibrary.wiley.com/doi/10.1029/93WR00877</a></p>
</div>
</div>
</div>
<div id="repo-link-1" class="section level3 hasAnchor" number="3.1.2">
<h3><span class="header-section-number">3.1.2</span> Repo link<a href="process-based-modeling---probabilistic-and-process-simulation.html#repo-link-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><a href="https://github.com/tpcovino/04_transfer_functions.git" target="_blank">Download the repo for this lab HERE</a></p>
</div>
<div id="labwork-20-pts-3" class="section level3 hasAnchor" number="3.1.3">
<h3><span class="header-section-number">3.1.3</span> Labwork (20 pts)<a href="process-based-modeling---probabilistic-and-process-simulation.html#labwork-20-pts-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In this homework/lab, you will write a simple, lumped rainfall-runoff model. The foundation for this model is the TRANSEP model from Weiler et al., 2003. Since TRANSEP (tracer transfer function hydrograph separation model) contains a tracer module that we don’t need, we will only use the loss function (Jakeman and Hornberger) and the gamma transfer function for the water routing.<br />
The data for the model is from the Tenderfoot Creek Experimental Forest in central Montana.</p>
<p>Load packages with a function that checks and installs packages if needed:</p>
<p>Define input year
We could use every year in the time series, but for starters, we’ll use 2006. Use filter() to extract the 2006 water year.</p>
<p><strong>1) QUESTION: What does the function cumsum() do?(1 pt)</strong>
ANSWER:</p>
<p>Define the initial inputs <br><br>
This chunk defines the initial inputs for measured precip and measured runoff.</p>
<p>Parameterization <br><br>
We will use these parameters. You can change them if you want, but I’d suggest leaving them like this at least until you get the model to work. Even tiny changes can have a huge effect on the simulated runoff.</p>
<p>Loss function <br><br>
This is the module for the Jakeman and Hornberger loss function where we turn our measured input precip into effective precipitation (p_eff). This part contains three steps.<br />
1) preallocate a vector p_eff: Initiate an empty vector for effective precipitation that we will fill in with a loop using Peff(t) = p(t)s(t). Effective precipitation is the portion of precipitation that generates streamflow and event water contribution to the stream. It is separated to produce event water and displace pre-event water into the stream.
2) set the initial value for s: s(t) is an antecedent precipitation index. How much does antecedent precipitation affect effective precipitation?
3) generate p_eff inside of a for-loop<br />
Please note: The Weiler et al. (2003) paper states that one of the loss function parameters (vol_c) can be determined from the measured input. That is actually not the case.</p>
<p>s(t) is the antecedent precipitation index that is calculated by
exponentially weighting the precipitation backward in time according to the
parameter b2 is a ‘dial’ that places weight on past precipitation events.</p>
<p><strong>2) QUESTION (3 pts): Interpret the two figures. What is the meaning of “frac”?</strong>
For this answer, think about what the effective precipitation represents. When is frac “high”, when is “frac” low?</p>
<p>ANSWER:</p>
<p><strong>Extra Credit (2 pt): Combine the two plots into one, with a meaningfully scaled secondary y-axis</strong></p>
<p>Runoff transfer function<br><br>
Routing module -</p>
<p>This short chunk sets up the TF used for the water routing. This part contains only two steps:
1) the calculation of the actual TF.
2) normalization of the TF so that the sum of the TF equals 1.</p>
<p>tau(0) is the mean residence time</p>
<p><strong>3) QUESTION (2 pt): Why is it important to normalize the transfer function?</strong><br />
ANSWER:</p>
<p><strong>4) QUESTION (4 pt): Describe the transfer function. What are the units and what does the shape of the transfer function mean for runoff generation?</strong><br />
ANSWER:</p>
<p>Convolution<br><br></p>
<p>This is the heart of the model. Here, we convolute the input with the TF to generate runoff. There is another thing you need to pay attention to: We are only interested in one year (365 days), but since our TF itself is 365 timesteps long, small parts of all inputs except for the first one, will be turned into streamflow AFTER the water year of interest, that is, in the following year. In practice, this means you have two options to handle this.<br />
1) You calculate q_all and then manually cut the matrix/vector to the correct length at the end, or<br />
2) You only populate a vector at each time step and put the generated runoff per iteration in the correct locations within the vector. For this to work, you would need to trim the length of the generated runoff by one during each iteration. This approach is more difficult to code, but saves a lot of memory since you are only calculating/storing one vector of length 365 (or 366 during a leapyear).<br />
We will go with option 1). The code for option 2 is shown at the end for reference.</p>
<p>Convolution summarized (recall dollars and cookies): Each loop iteration results in a row of the matrix representing the convolution at a specific time step. each time step of p_eff is an iteration, and for each timestep, it multiplies the effective precipitation at that timestep by the entire transfer function. Then each row is summed and stored in the vector q_all. q_all_loop is an intermediate step in the convolution process and can help visualize how the convolution evolves over time.
As an example, if we have precip at time step 1, we are interested in how this contributes to runoff at time steps 1,2,3 etc, all the way to 365 (or the end of our period). so the first row of the matrix q_all_loop represents the contribution of precipitation at timestep 1 to runoff at each timestep. the second row represents the contribution of precipitation at time step 2 to runoff at each timestep. Then when we sum up the rows, we get q_all, where each element represents the total runoff at a specific time step.</p>
<p><strong>5) QUESTION (5 pts): We set the TF length to 365. What is the physical meaning of this (i.e., how well does this represent a real system and why)? Could the transfer function be shorter or longer than that?</strong></p>
<p>ANSWER:</p>
<p>Plots <br><br>
Plot the observed and simulated runoff. Include a legend and label the y-axis.</p>
<p><strong>6) QUESTION (3 pt): Evaluate how good or bad the model performed (i.e., visually compare simulated and observed streamflow, e.g., low flows and peak flows).</strong><br />
ANSWER:</p>
<p><strong>7) QUESTION (2 pt): Compare the effective precipitation total with the simulated runoff total and the observed runoff total. What is p_eff and how is it related to q_all? Discuss why there is a (small) mismatch between the sums of p_eff and q_all.</strong><br />
ANSWER:</p>
<p>THIS IS THE CODE FOR CONVOLUTION METHOD 2<br />
This method saves storage requirements since only a vector is generated and not a full matrix that contains all response pulses. The workflow here is to generate a a response vector for the first pulse. This will take up 365 time steps. On the second time step, we generate another response pulse with 364 steps that starts at t=2. We then add that vector to the first one. On the third time step, we generate a response pulse of length 363 that starts at t=3 and then add it to the existing one. And so on and so forth.</p>

</div>
</div>
<div id="monte-carlo-simulation" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Monte Carlo Simulation<a href="process-based-modeling---probabilistic-and-process-simulation.html#monte-carlo-simulation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="learning-module-5" class="section level3 hasAnchor" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Learning Module 5<a href="process-based-modeling---probabilistic-and-process-simulation.html#learning-module-5" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="background" class="section level4 hasAnchor" number="3.2.1.1">
<h4><span class="header-section-number">3.2.1.1</span> Background:<a href="process-based-modeling---probabilistic-and-process-simulation.html#background" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Monte Carlo Simulation is a method to estimate the probability of the outcomes of an uncertain event. It is based on a law of probability theory that says if we repeat an experiment many times, the average of the results will get closer to the true probability of those outcomes.</p>
<p>First check out this video:
<iframe src="https://www.youtube.com/embed/7TqhmX92P6U" width="672" height="400px" data-external="1"></iframe></p>
</div>
<div id="reading" class="section level4 hasAnchor" number="3.2.1.2">
<h4><span class="header-section-number">3.2.1.2</span> Reading<a href="process-based-modeling---probabilistic-and-process-simulation.html#reading" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Then read this: <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2924739/" class="uri">https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2924739/</a> for a understanding of the fundamentals.</p>
</div>
<div id="how-does-this-apply-to-hydrological-modeling" class="section level4 hasAnchor" number="3.2.1.3">
<h4><span class="header-section-number">3.2.1.3</span> How does this apply to hydrological modeling?<a href="process-based-modeling---probabilistic-and-process-simulation.html#how-does-this-apply-to-hydrological-modeling" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>When modeling watershed hydrological processes, we often attempting to quantify<br><br></p>
<ul>
<li>watershed inputs <br>
<ul>
<li>e.g., precipitation <br></li>
</ul></li>
<li>watershed outputs <br>
<ul>
<li>e.g., <a href="https://www.usgs.gov/special-topics/water-science-school/science/evapotranspiration-and-water-cycle#:~:text=Evapotranspiration%20includes%20water%20evaporation%20into,to%20the%20atmosphere%20via%20plants">evapotranspiration</a>, <a href="https://www.usgs.gov/media/images/sublimation-occurs-snow-covered-mountains">sublimation</a>, runoff/discharge <br></li>
</ul></li>
<li>watershed storage <br>
<ul>
<li>precipitation that is not immediately converted to runoff or ET rather stored as snow or subsurface water. <br></li>
</ul></li>
</ul>
<p>Imagine we are trying to predict the percentage of precipitation stored in a watershed after a storm event. We have learned that there are may factors that affect this prediction, like antecedent conditions, that may be difficult to measure directly. Monte Carlo Simulation can offer a valuable approach to estimate the probability of obtaining certain measurements when those factors can not be directly observed or measured. We can approximate the likelihood of specific measurement by simulating a range of possible scenarios. <br></p>
<p>Monte Carlo Simulation is not only useful for estimating probabilities, but for conducting sensitivity analysis. In any model, there are usually several input parameters. Sensitivity analysis helps us understand how changes in these parameters affect the predicted values. To perform a sensitivity analysis using a Monte Carlo Simulation we can:</p>
<ul>
<li>Define the realistic ranges for each parameter we want to analyze</li>
<li>Using Monte Carlo Simulation, randomly sample values from the defined ranges for each parameter</li>
<li>Analyze output to understand how different input sample values affect the predicted output</li>
</ul>
</div>
<div id="example" class="section level4 hasAnchor" number="3.2.1.4">
<h4><span class="header-section-number">3.2.1.4</span> Example<a href="process-based-modeling---probabilistic-and-process-simulation.html#example" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Let’s consider all of this in an example model called <a href="https://agupubs.onlinelibrary.wiley.com/doi/full/10.1002/2014WR016719">WECOH - Watershed ECOHydrology</a>. In this study, researchers (Nippgen et al.) were interested in the change in subsurface water storage through time and space on a daily and seasonal basis.</p>
<div class="float">
<img src="images/wrcr21497-fig-0009-m.jpg" style="width:50.0%" alt="Evolution of watershed connectivity" />
<div class="figcaption">Evolution of watershed connectivity</div>
</div>
<p><br/><br/>
The authors directly measured runoff/discharge, collected precipitation data at several points within the watershed, used remote sensing to estimate how much water was lost to evapotranspiration, and used digital elevation models to characterize the watershed topography. As we learned in the hydrograph separation module, topographic characteristics can have a significant impact on storage. <br>
Though resources like <a href="https://websoilsurvey.sc.egov.usda.gov/app/">USDA’s Web Soil Survey</a> can provide a basic understanding underlying geology across a large region, characterizing the heterogeneous nature of soils within a watershed can be logistically unfeasible. To estimate the soil characteristics like storage capacity (how much water the soil can hold) and hydraulic conductivity (how easily water can move through soil) in the study watershed, the authors used available resources to determine the possible range of values for each of their unknown parameters. They then tested thousands of model simulations using randomly selected values with the predetermined range for each of the soil characteristics. They compared the simulated discharge from these simulations to the actual discharge measurements. The simulations that predicted discharge patterns that closely matched reality helped them to estimate the unknown soil properties. Additionally, from the results of these simulations, they could identify which model inputs had the most significant impact on the discharge predictions, and how sensitive the output was to changes in each parameter. In this case, they determined that the model and system were most sensitive to precipitation. This type of sensitivity analysis can help us interpret the relative importance of different parameters and understand the overall sensitivity of the model or system. The study is linked for your reference but a thorough reading is not required.</p>
</div>
<div id="optional-reading" class="section level4 hasAnchor" number="3.2.1.5">
<h4><span class="header-section-number">3.2.1.5</span> Optional Reading<a href="process-based-modeling---probabilistic-and-process-simulation.html#optional-reading" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><a href="https://www.researchgate.net/publication/262765548_Development_of_probability_distributions_for_urban_hydrologic_model_parameters_and_a_Monte_Carlo_analysis_of_model_sensitivity">This methods paper</a> by Knighton et al. is an example of how Monte Carlo Simulation was used to estimate hydraulic conductivity in an urban system with varied land-cover..</p>
</div>
<div id="generate-a-simulation-with-code" class="section level4 hasAnchor" number="3.2.1.6">
<h4><span class="header-section-number">3.2.1.6</span> Generate a simulation with code<a href="process-based-modeling---probabilistic-and-process-simulation.html#generate-a-simulation-with-code" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>For a 12-minute example in RStudio, check this out. If you are still learning the basics of R functionality, it may be helpful to code along with this video, pausing as needed. Note that this instruction is coding in an Rscript (after opening RStudio &gt; File &gt; New File &gt; R Script), rather than an Rmarkdown that we use in this class.</p>
<iframe src="https://www.youtube.com/embed/inJsu-ygBfM" width="672" height="400px" data-external="1">
</iframe>
</div>
</div>
<div id="repo-link-2" class="section level3 hasAnchor" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> Repo link<a href="process-based-modeling---probabilistic-and-process-simulation.html#repo-link-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><a href="https://github.com/tpcovino/05_monte_carlo.git" target="_blank">Download the repo for this lab HERE</a></p>
</div>
<div id="labwork-20-pnts" class="section level3 hasAnchor" number="3.2.3">
<h3><span class="header-section-number">3.2.3</span> Labwork (20 pnts)<a href="process-based-modeling---probabilistic-and-process-simulation.html#labwork-20-pnts" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In this lab/homework, you will use the transfer function model from the previous module for some sensitivity analysis using Monte Carlo simulations. The code is mostly the same as last module with some small adjustments to save the parameters from each Monte Carlo run.
In this Monte Carlo simulation, we’re testing how different parameter values affect simulated streamflow (discharge). Since we don’t know the true values of certain model parameters (like b1, b2, b3, a, and b that you may recall from the transfer function), we randomly sample them within a reasonable range and run the model many times to see which parameter combinations best match observed streamflow data. Each iteration of the loop represents one possible “guess” at the true parameter values, and we evaluate how good that guess is using metrics like Nash-Sutcliffe Efficiency (NSE), Kling-Gupta Efficiency (KGE), Root Mean Square Error (RMSE), and Mean Absolute Error (MAE).
After the completion of the MC runs, we will use the Generalized Likelihood Uncertainty estimation (GLUE) method to evaluate parameter sensitivity. In other words, we sort all the runs to find the best-fitting parameter combinations, which helps us understand the most likely values of these unknown parameters in our hydrological model.</p>
<p>There are three main objectives for this homework:<br />
1) Set up the Monte Carlo analysis<br>
2) Run the MC simulation for ONE of the years in the study period and perform a GLUE sensitivity analysis<br />
3) Compare the different objective functions.</p>
<p>A lot of the code in this homework will be provided.</p>
<div id="setup" class="section level4 hasAnchor" number="3.2.3.1">
<h4><span class="header-section-number">3.2.3.1</span> Setup<a href="process-based-modeling---probabilistic-and-process-simulation.html#setup" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Import packages, including the “progress” and “tictoc” packages. These will allow us to time our loops and functions</p>
<p>Read data - this is the same PQ data we have worked with in previous modules.</p>
<p>Define variables</p>
</div>
<div id="parameter-initialization" class="section level4 hasAnchor" number="3.2.3.2">
<h4><span class="header-section-number">3.2.3.2</span> Parameter initialization<a href="process-based-modeling---probabilistic-and-process-simulation.html#parameter-initialization" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>This chunk has two purposes. The first is to set up the number of iterations for the Monte Carlo simulation. The entire model code is essentially wrapped into the main MC for loop. Each iteration of that loop is one full model realization: loss function, TF, convolution, model fit assessment (objective function). For each model run (each MC iteration), we will save the model parameters and respective objective functions in a dataframe. This will be the main source for the GLUE sensitivity analysis at the end. The model parameters are sampled in the main model chunk, this is just the preallocation of the dataframe.<br />
You will both run your own MC simulation, to set up the code, but will also receive a .Rdata file with 100,000 runs to give you more behavioral runs for the sensitivity analysis and uncertainty bounds. As a tip, while setting up the code, I would recommend setting the number of MC iterations to something low, for example 10 or maybe even 1. Once you have confirmed that your code works, crank up the number of iterations. Set it to 1000 to see how many behavioral runs you get. After that, load the file with the provided runs.</p>
</div>
<div id="mc-model-run" class="section level4 hasAnchor" number="3.2.3.3">
<h4><span class="header-section-number">3.2.3.3</span> MC Model run<a href="process-based-modeling---probabilistic-and-process-simulation.html#mc-model-run" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>This is the main model chunk. The tic() and toc() statements measure the execution time for the whole chunk. There is also a progressbar in the chunk that3 will run in the console and inform you about the progress of the MC simulation. The loss function parameters are set in the loss function, the TF parameters in the loss function code. For each loop iteration, we will store the parameter values and the simulated discharge in the “param” dataframe. So, if we ran the MC simulation 100 times, we would end up with 100 parameter combinations and simulated discharges.</p>
<p><strong>Q1 (2 pt) How are the loss function and transfer function parameters being sampled? That is, what is the underlying distribution and why did we choose it? (2-3 sentences)</strong><br />
ANSWER:</p>
<p><strong>Extra point: What does the while loop do in the transfer function calculation? And why is it in there? (1-2 sentences)</strong><br />
ANSWER:</p>
<p>Save or load data</p>
<p>After setting up the MC simulation, we will actually use a pre-created dataset. Running the MC simulation tens of thousands of times will take multiple hours. For that reason, we have done this for you and saved it as an importable data set.</p>
<p>Best run</p>
<p>Now that we have the dataframe with all parameter combinations and all efficiencies, we can plot the best simulation and compare it to the observed discharge</p>
</div>
</div>
<div id="sensitivity-analysis" class="section level3 hasAnchor" number="3.2.4">
<h3><span class="header-section-number">3.2.4</span> Sensitivity analysis<a href="process-based-modeling---probabilistic-and-process-simulation.html#sensitivity-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We will use the GLUE methodology to assess parameter sensitivity. We will use GLUE for two purposes:
1) Assessing parameter sensitivity – Understanding how different parameter values influence model performance
2) Creating an envelope of model simulations – Identifying a range of possible model outputs that fit the observed data</p>
<p>To start, we need to format the data so we can create dotty plots and density plots using Nash-Sutcliffe Efficiency (NSE) as our performance metric.</p>
<p>When plotting, each parameter should be displayed in its own panel. You can achieve this using facet_wrap() in ggplot2, and be sure to set the axis scaling to “free” so each parameter is properly visualized</p>
<p><strong>Q2 (4 pts) Describe the sensitivity analysis with the three different plots. Are the parameters sensitive? Which ones are, which ones are not? Does this affect your “trust” in the model? (5-8 sentences)</strong><br />
ANSWER:</p>
<p><strong>Q3 (4 pts) What are the differences between the dotty plots and the density plots? What are the differences between the two density plots? (2-3 sentences)</strong> ANSWER:</p>
<p>Uncertainty bounds
In this section, we will generate uncertainty bounds for our simulation results. Instead of using all model runs, we will only include the behavioral runs—the ones that meet our performance criteria. This ensures that our uncertainty range reflects only the most realistic simulations.</p>
<p><strong>Q4 (3 pts) Describe what the envelope actually is. Could we say we are dealing with confidence or prediction intervals? (2-3 sentences)</strong><br />
Hint: Think about what the envelope is capturing. Does it reflect uncertainty in the model structure and parameters or does it describe the variability in future observations?
ANSWER:</p>
<p><strong>Q5 (3 pts) If you inspect the individual model runs (in the Qruns df), you will notice that they all perform somewhat poorly when it comes to the initial baseflow. Why is that and what could you do to change this? (Note: you don’t have to actually do this, just describe how you might approach that issue (2-3 sentences)</strong><br />
Hint: Consider factors such as parameter initialization, storage effects, or missing processes in the model structure. What tuning or modifications could address this?
ANSWER:</p>
<p><strong>Q6 (4 pts) Run the provided code to generate a plot comparing the best model run for each objective function. Then, analyze the differences in model performance by answering the following:</strong>
Which objective function provides the best match to observed runoff overall?
How do the different functions perform in capturing peak flow events?
Which function best represents baseflow conditions? Which struggles the most?
If you were to prioritize accuracy in low-flow conditions, which objective function might you choose and why?**
ANSWER:</p>
<p>The coding steps are: 1) get the simulated q vector with the best run for each objective function, 2) put them in a dataframe/tibble, 3) create the long form, 4) plot the long form dataframe/tibble. These steps are just ONE possible outline how the coding steps can be broken up.</p>
<p>Response surface</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="fundamentals-of-hydrological-analysis---physical-hydrology-and-empirical-methods.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="model-classification-and-application.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/tpcovino/lres_546_bookdown/edit/main/05_transfer_function_lecture_and_lab.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/tpcovino/lres_546_bookdown/blob/main/05_transfer_function_lecture_and_lab.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
